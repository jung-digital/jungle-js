function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,i){for(var s=!0;s;){var n=t,a=e,o=i;r=l=h=void 0,s=!1,null===n&&(n=Function.prototype);var r=Object.getOwnPropertyDescriptor(n,a);if(void 0!==r){if("value"in r)return r.value;var h=r.get;return void 0===h?void 0:h.call(o)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=a,i=o,s=!0}},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("shared/util/util")):"function"==typeof define&&define.amd?define(["shared/util/util"],e):t.Embers=e(t.util)}(this,function(t){"use strict";var e=function(){function t(e){_classCallCheck(this,t),this.id=e.id||-1,this.pathRedraw=e.pathRedraw,this.sparkLength=e.sparkLength||200,this.sparkResolution=e.sparkResolution||20,this.options=e,this.paths=[],this.sparking=!1}return _createClass(t,[{key:"reset",value:function(){this.sparking=!1}},{key:"spark",value:function(t){if(!this.sparking){for(var e in t)this.options[e]=t[e];this.onFrameCallback=t.onFrameCallback,this.velocity=t.velocity,this.sparking=!0,this.position=this.options.position,this.points=this.options.position?[this.options.position]:void 0}}},{key:"next",value:function(t){this.position=t,this.points=this.points||[],this.points.push(t),this.points.length>this.sparkResolution&&this.points.shift()}},{key:"onFrame",value:function(t,e){this.sparking&&(this.onFrameCallback&&this.onFrameCallback.call(this,t,e),this.updateTail(t,e))}},{key:"updateTail",value:function(t,e){if(this.points.length>1)for(var i=0;i<this.points.length-1;i++){var s=this.points[this.points.length-(i+1)],n=this.points[this.points.length-(i+2)];this.pathRedraw(this,s,n,i/(this.sparkResolution-1),t,e)}}}]),t}(),i=function p(){_classCallCheck(this,p),this.Spark=e},s=(new i,800),n=800/1.618,a=function(){function t(e,i){_classCallCheck(this,t),this.canvas=e,this.ctx=e.getContext("2d"),this.lastTime=0,this.canvasTargetWidth=this.width=s,this.canvasTargetHeight=this.height=n,window.addEventListener("resize",this.resizeHandler.bind(this)),e.addEventListener("mousemove",this.onMouseMoveHandler.bind(this)),e.addEventListener("mouseout",this.onMouseOutHandler.bind(this)),e.addEventListener("touchstart",this.onTouchStartHandler.bind(this)),e.addEventListener("touchmove",this.onTouchMoveHandler.bind(this)),e.setAttribute("width",s),e.setAttribute("height",n),i&&e.setAttribute("id",i),window.requestAnimationFrame(this.onFrameFirst.bind(this))}return _createClass(t,[{key:"resizeHandler",value:function(t){var e=Math.min(800,window.innerWidth);canvas.style.width=this.state.canvasTargetWidth=e,canvas.style.height=this.state.canvasTargetHeight=e/1.618,this.resize()}},{key:"resize",value:function(){console.log("Resized!",this.state.canvasTargetWidth,this.state.canvasTargetHeight)}},{key:"onMouseMoveHandler",value:function(){}},{key:"onMouseOutHandler",value:function(){}},{key:"onTouchStartHandler",value:function(){}},{key:"onTouchMoveHandler",value:function(){}},{key:"onFrameFirst",value:function(t){this.lastTime=t,window.requestAnimationFrame(this.onFrame.bind(this))}},{key:"onFrameHandler",value:function(t){this.lastTime?this.elapsed=(t-this.lastTime)/1e3:(this.lastTime=t,this.elapsed=.01)}}]),t}(),o=500,r=800,h=800/1.61,l=50,c=5e3,u=function(i){function s(t){_classCallCheck(this,s),_get(Object.getPrototypeOf(s.prototype),"constructor",this).call(this,t),this.hue=0,this.sparkSource=new gl.vec2.fromValues(r/2,h/5),this.sparks=[];for(var i=0;o>i;i++)this.sparks.push(new e({pathRedraw:this.pathRedraw,sparkResolution:4}))}return _inherits(s,i),_createClass(s,[{key:"pathRedraw",value:function(t,e,i,s,n,a){s=1-s,a.strokeStyle="rgba("+~~(256*t.options.color.r)+","+~~(256*t.options.color.g)+","+256*~~t.options.color.b+","+s+")",a.lineWidth=t.options.size*s,a.beginPath(),a.moveTo(e[0],e[1]),a.lineTo(i[0],i[1]),a.stroke()}},{key:"onFrame",value:function(t){var e=this;this.ctx.clearRect(0,0,this.state.WIDTH,this.state.HEIGHT),this.elapsed=(t-this.lastTime)/1e3,this.lastTime=t,this.hue=Math.random()*Math.random()*60,this.sparks.forEach(function(t){t.sparking||e.startSpark(t),e.sparkOnFrame.call(t,e),t.onFrame(e.elapsed,e.ctx)}),window.requestAnimationFrame(this.onFrame.bind(this))}},{key:"startSpark",value:function(e){var i=Math.random()-.5-Math.PI/2,s=Math.random()*Math.PI*2,n=Math.random()*l,a=t.hsvToRgb(this.hue,1,.8);e.spark({type:2,size:2*Math.random()+1,color:a,position:gl.vec2.add(gl.vec2.create(),this.sparkSource,gl.vec2.fromValues(Math.cos(s)*n,Math.sin(s)*n)),velocity:gl.vec2.scale(gl.vec2.create(),gl.vec2.fromValues(Math.cos(i),Math.sin(i)),150*Math.random()+20),heatCurrent:0,lastAngleChangeTime:0,life:4*Math.random()+2})}},{key:"sparkOnFrame",value:function(t){var e=Math.random()*c+(t.lastTime-this.options.lastAngleChangeTime);if(e>c){var i=1.047*Math.random()-.5235,s=gl.mat2.create();gl.mat2.rotate(s,s,i),gl.vec2.transformMat2(this.options.velocity,this.options.velocity,s),this.options.lastAngleChangeTime=t.lastTime}this.options.heatCurrent+=Math.random(),this.options.life-=t.elapsed;var n=gl.vec2.scaleAndAdd(gl.vec2.create(),this.position,this.options.velocity,t.elapsed);this.next(n),(this.options.life<0||n.y>h+50||n.x<-50||n.y<-50||n.x>r+50)&&this.reset()}},{key:"onMouseMoveHandler",value:function(t){var e=this.canvas.getBoundingClientRect(),i=r/this.state.canvasTargetWidth;this.sparkSource=gl.vec2.fromValues((t.clientX-e.left)*i,(t.clientY-e.top)*i)}},{key:"onTouchMoveHandler",value:function(t){t.preventDefault();var e=this.canvas.getBoundingClientRect(),i=r/this.state.canvasTargetWidth;this.sparkSource=gl.vec2.fromValues((t.touches[0].clientX-e.left)*i,(t.touches[0].clientY-e.top)*i)}}]),s}(a);return u});
//# sourceMappingURL=Embers.min.js.map