function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _get=function(t,i,e){for(var s=!0;s;){var o=t,n=i,a=e;r=l=h=void 0,s=!1,null===o&&(o=Function.prototype);var r=Object.getOwnPropertyDescriptor(o,n);if(void 0!==r){if("value"in r)return r.value;var h=r.get;return void 0===h?void 0:h.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return void 0;t=l,i=n,e=a,s=!0}},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Embers=i()}(this,function(){"use strict";function t(t,i){return Math.random()*(i-t)+t}function i(i){return i[Math.floor(t(0,i.length-1e-6))]}function e(t,i){return t.y<i.y}function s(t,i){return t.y>i.y}function o(t,i){return t.x<i.x}function n(t,i){return t.x>i.x}function a(t){return(t-1+2)%4+1}function r(t,i){var a=[];return e(t,i)&&a.push(4),s(t,i)&&a.push(2),o(t,i)&&a.push(3),n(t,i)&&a.push(1),a}function h(t){return t==m.LEFT?new paper.Point(-1,0):t==m.RIGHT?new paper.Point(1,0):t==m.TOP?new paper.Point(0,-1):t==m.BOTTOM?new paper.Point(0,1):void 0}function l(i,e){var s=0;s=i==m.RIGHT?e.right:s,s=i==m.TOP||i==m.BOTTOM?t(0,e.right):s;var o=0;return o=i==m.BOTTOM?e.bottom:o,o=i==m.LEFT||i==m.RIGHT?t(0,e.bottom):o,new paper.Point(s,o)}function c(t,i,e){var s,o,n,a,r,h,l,c;if(0==i)h=l=c=e;else switch(t/=60,s=Math.floor(t),o=t-s,n=e*(1-i),a=e*(1-i*o),r=e*(1-i*(1-o)),s){case 0:h=e,l=r,c=n;break;case 1:h=a,l=e,c=n;break;case 2:h=n,l=e,c=r;break;case 3:h=n,l=a,c=e;break;case 4:h=r,l=n,c=e;break;default:h=e,l=n,c=a}return{r:h,g:l,b:c}}var p=function(){function t(i){_classCallCheck(this,t),this.id=i.id||-1,this.pathRedraw=i.pathRedraw,this.sparkResolution=i.sparkResolution||20,this.options=i,this.paths=[],this.sparking=!1}return _createClass(t,[{key:"reset",value:function(){this.sparking=!1}},{key:"spark",value:function(t){if(!this.sparking){for(var i in t)this.options[i]=t[i];this.onFrameCallback=t.onFrameCallback,this.velocity=t.velocity,this.sparking=!0,this.position=this.options.position,this.points=this.options.position?[this.options.position]:void 0}}},{key:"next",value:function(t){if(t){this.points=this.points||[];for(var i=vec2.sub(vec2.create(),t,this.position),e=vec2.normalize(vec2.create(),i),s=vec2.len(i),o=1;s>o;o+=1){var n=vec2.create(),a=vec2.add(n,vec2.scale(n,e,o),this.position);this.points.push(a)}for(this.points.push(t),this.position=t;this.points.length>this.sparkResolution;)this.points.shift()}}},{key:"onFrame",value:function(t,i){this.sparking&&(this.onFrameCallback&&this.onFrameCallback.call(this,t,i),this.updateTail(t,i))}},{key:"updateTail",value:function(t,i){if(this.points.length>1)for(var e=0,s=0;s<this.points.length-1;s++){var o=this.points[this.points.length-(s+1)],n=this.points[this.points.length-(s+2)];e+=vec2.len(vec2.sub(vec2.create(),n,o)),this.pathRedraw(this,o,n,e,s/(this.sparkResolution-1),t,i)}}}]),t}(),u=function F(){_classCallCheck(this,F),this.Spark=p},f=(new u,800),d=800/1.618,v=function(){function t(i,e,s){_classCallCheck(this,t),this.canvas=i,this.ctx=i.getContext("2d"),this.options=e||{},this.options.fillCanvas=this.options.fillCanvas===!1?!1:!0,this.lastTime=0,this.options.fillCanvas?setTimeout(this.resizeHandler.bind(this),250):(this.canvasTargetWidth=this.width=this.options.width||f,this.canvasTargetHeight=this.height=this.options.width||d),window.addEventListener("resize",this.resizeHandler.bind(this)),this.lastScrollTop=window.scrollY,window.addEventListener("scroll",this._scrollHandler.bind(this)),i.addEventListener("mousemove",this.onMouseMoveHandler.bind(this)),i.addEventListener("mouseout",this.onMouseOutHandler.bind(this)),i.addEventListener("touchstart",this.onTouchStartHandler.bind(this)),i.addEventListener("touchmove",this.onTouchMoveHandler.bind(this)),i.setAttribute("width",f),i.setAttribute("height",d),s&&i.setAttribute("id",s),window.requestAnimationFrame(this._onFrameFirstHandler.bind(this))}return _createClass(t,[{key:"resizeHandler",value:function(t){if(this.options.fillCanvas){var i=window.innerWidth,e=window.innerHeight;this.canvas.width=this.canvas.style.width=this.canvasTargetWidth=this.width=i,this.canvas.height=this.canvas.style.height=this.canvasTargetHeight=this.height=e}else{var s=Math.min(800,window.innerWidth);this.canvas.style.width=this.canvasTargetWidth=s,this.canvas.style.height=this.canvasTargetHeight=s/1.618}this.resize()}},{key:"_scrollHandler",value:function(t){var i=window.scrollY-this.lastScrollTop;this.lastScrollTop=window.scrollY,this.scrollHandler(i)}},{key:"scrollHandler",value:function(t){console.log("Scrolling!",t)}},{key:"resize",value:function(){console.log("Resized!",this.canvasTargetWidth,this.canvasTargetHeight)}},{key:"onMouseMoveHandler",value:function(){}},{key:"onMouseOutHandler",value:function(){}},{key:"onTouchStartHandler",value:function(){}},{key:"onTouchMoveHandler",value:function(){}},{key:"_onFrameFirstHandler",value:function(t){this.lastTime=t,window.requestAnimationFrame(this._onFrameHandler.bind(this))}},{key:"_onFrameHandler",value:function(t){window.requestAnimationFrame(this._onFrameHandler.bind(this)),this.elapsed=Math.min(.1,(t-this.lastTime)/1e3),this.lastTime=t,this.onFrameHandler(this.elapsed),this.options.debug&&(this.ctx.font="12px Georgia white",this.ctx.fillStyle="white",this.ctx.fillText(this.debugText,10,50))}},{key:"debugText",get:function(){return this.canvas.width+", "+this.canvas.height+" FPS: "+Math.round(1/this.elapsed)}}]),t}(),m={LEFT:1,TOP:2,RIGHT:3,BOTTOM:4,ran:function(){return Math.floor(t(1,4.99))}},k={ran:t,ranItem:i,Sides:m,isAbove:e,isBelow:s,isLeft:o,isRight:n,reverseOf:a,toward:r,vecFor:h,hsvToRgb:c,getRandomPointFor:l},g=100,y=3.4,w=1,T=70,b=20,S=40,M=5e3,x=10,C=20,H=10,O=function(t){function i(t,e){_classCallCheck(this,i),_get(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,t,e),this.options.sparkCount=this.options.sparkCount||g,this.options.maxSparkSize=this.options.maxSparkSize||y,this.options.minSparkSize=this.options.minSparkSize||w,this.options.maxSparkVelocity=this.options.maxSparkVelocity||T,this.options.minSparkVelocity=this.options.minSparkVelocity||b,this.options.maxTailLength=this.options.maxTailLength||C,this.options.sparkCount=this.options.sparkCount||g,this.options.maxSparkLife=this.options.maxSparkLife||H,this.sparkSource=this.options.sparkSource?this.options.sparkSource:new vec2.fromValues(this.width/2,this.height/5),this.sparks=[];for(var s=0;s<this.options.sparkCount;s++)this.sparks.push(new p({pathRedraw:this.pathRedraw.bind(this),sparkResolution:4}))}return _inherits(i,t),_createClass(i,[{key:"pathRedraw",value:function(t,i,e,s,o,n,a){o=1-s/this.options.maxTailLength;var r=k.hsvToRgb(t.options.color.h,t.options.color.s,t.options.color.l);a.strokeStyle="rgba("+~~(256*r.r)+","+~~(256*r.g)+","+256*~~r.b+","+o*t.options.lifeRatio+")",a.lineWidth=t.options.size*o,a.beginPath(),a.moveTo(i[0],i[1]),a.lineTo(e[0],e[1]),a.stroke()}},{key:"onFrameHandler",value:function(t){var i=this;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.sparks.forEach(function(e){if(!e.sparking){if(!(Math.random()>1-1*t/5))return;i.startSpark(e)}i.sparkOnFrame.call(e,i),e.onFrame(i.elapsed,i.ctx)})}},{key:"scrollHandler",value:function(t){var i=vec2.fromValues(0,-t);this.sparks.forEach(function(t){t.sparking&&(t.points=t.points.map(function(t){return vec2.add(vec2.create(),t,i)}),vec2.add(t.position,t.position,i))})}},{key:"startSpark",value:function(t){var i=Math.random()-.5-Math.PI/2,e=Math.random()*Math.PI*2,s=Math.random()*S,o=Math.random()*this.options.maxSparkLife/2+this.options.maxSparkLife/2,n=this.sparkSource;if(!n.target)throw"Huge error";var a=n.target.getBoundingClientRect(),r=0,h=0;n.offset&&n.offset.x&&(r=-1!=n.offset.x.indexOf("%")?n.target[n.widthProp]*(parseFloat(n.offset.x)/100):n.offset.x),n.offset&&n.offset.y&&(h=-1!=n.offset.y.indexOf("%")?n.target[n.heightProp]*(parseFloat(n.offset.y)/100):n.offset.y),n=vec2.fromValues(r,Math.min(h+a.top,window.innerHeight)),t.spark({type:2,sparkResolution:x,size:Math.random()*(this.options.maxSparkSize-this.options.minSparkSize)+this.options.minSparkSize,color:{h:28*Math.random()+20,s:.4*Math.random()+.6,l:1},position:vec2.add(vec2.create(),n,vec2.fromValues(Math.cos(e)*s,Math.sin(e)*s)),velocity:vec2.scale(vec2.create(),vec2.fromValues(Math.cos(i),Math.sin(i)),Math.random()*(this.options.maxSparkVelocity-this.options.minSparkVelocity)+this.options.minSparkVelocity),heatCurrent:0,lastAngleChangeTime:0,glow:.8*Math.random()+.2,flickerSpeed:Math.random(),life:o,lifeTotal:this.options.maxSparkLife})}},{key:"sparkOnFrame",value:function(t){var i=Math.random()*M+(t.lastTime-this.options.lastAngleChangeTime);if(i>M){var e=1.047*Math.random()-.5235,s=mat2.create();mat2.rotate(s,s,e),vec2.transformMat2(this.options.velocity,this.options.velocity,s),this.options.lastAngleChangeTime=t.lastTime}this.options.heatCurrent+=Math.random(),this.options.life-=t.elapsed,this.options.color.l=this.options.life/this.options.lifeTotal*this.options.glow,this.options.lifeRatio=this.options.life/this.options.lifeTotal;var o=vec2.scaleAndAdd(vec2.create(),this.position,this.options.velocity,t.elapsed);this.next(o),(this.options.life<0||o[1]>t.canvas.height||o[0]<0||o[1]<0||o[0]>t.canvas.width)&&(console.log("Death of spark"),this.reset())}}]),i}(v);return O});
//# sourceMappingURL=Embers.min.js.map